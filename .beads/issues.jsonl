{"id":"otherworlds-rpg-0b4","title":"Implement API route handlers","description":"Implement route handlers for each bounded context in otherworlds-api. Currently all domain routes return empty Router::new(). Each context needs command endpoints (POST) that accept JSON, dispatch to command handlers, and return results, plus query endpoints (GET) that read projections. Routes nest at /api/v1/{context} (e.g., /api/v1/narrative, /api/v1/characters). Requires AppState to have EventRepository wired in.","status":"closed","priority":1,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-02-27T22:24:08Z","created_by":"Christopher Bartling","updated_at":"2026-02-28T00:00:00Z","closed_at":"2026-02-28T00:00:00Z"}
{"id":"otherworlds-rpg-4ln","title":"Implement domain command handlers","description":"Implement command handlers for the 7 domain crates (narrative, rules, world-state, character, inventory, session, content). Each crate has an empty placeholder at src/application/command_handlers.rs. Handlers should accept Commands, validate them, produce DomainEvents, and persist via EventRepository. Follow the event-driven flow: Command -\u003e CommandHandler -\u003e DomainEvent(s) -\u003e EventRepository.append_events(). Use TDD — write failing tests first.","design":"## Narrative Exemplar First\n\nImplement otherworlds-narrative command handlers as the exemplar pattern, then replicate to remaining 6 crates in follow-up.\n\n### Architecture Decisions\n1. Function-based handlers: `async fn handle_*(cmd, \u0026dyn Clock, \u0026dyn EventRepository) -\u003e Result\u003cVec\u003cEvent\u003e, DomainError\u003e`\n2. Aggregate domain methods push events to `uncommitted_events`\n3. `apply()` stays minimal (version increment only)\n4. `apply_stored_event_version_only()` shortcut for reconstitution (full StoredEvent deserialization out of scope)\n5. Sequence number: `version + uncommitted_events.len() + 1`\n6. `causation_id` = `correlation_id` at command-to-event boundary\n\n### Files to Modify\n- `backend/crates/otherworlds-narrative/src/domain/aggregates.rs` — Add `advance_beat()`, `present_choice()` + tests\n- `backend/crates/otherworlds-narrative/src/application/command_handlers.rs` — Add handler fns + mock tests\n- `backend/crates/otherworlds-narrative/Cargo.toml` — Add tokio dev-dep\n\n### TDD Steps\n1. RED/GREEN: `advance_beat()` domain method on `NarrativeSession` → `BeatAdvanced` event\n2. RED/GREEN: `present_choice()` domain method → `ChoicePresented` event\n3. RED/GREEN: `handle_advance_beat()` async handler fn with MockEventRepository\n4. RED/GREEN: `handle_present_choice()` async handler fn\n5. Refactor: clippy, fmt, full test suite\n\n### Tests: 4 total (2 aggregate unit tests + 2 handler unit tests)","status":"closed","priority":1,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-02-27T22:24:02Z","created_by":"Christopher Bartling","updated_at":"2026-02-27T22:59:54Z","closed_at":"2026-02-27T22:59:54Z"}
{"id":"otherworlds-rpg-5o1","title":"Rename Postgres container in Docker Compose config","status":"open","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-03-01T15:39:31Z","created_by":"Christopher Bartling","updated_at":"2026-03-01T15:56:12Z"}
{"id":"otherworlds-rpg-6mf","title":"Wire PgEventRepository into AppState","description":"Add an Arc\u003cdyn EventRepository + Send + Sync\u003e field to AppState in otherworlds-api so route handlers can access the event store. Instantiate PgEventRepository from the PgPool during server startup in main.rs. Currently AppState holds PgPool, Clock, and Rng but the repository is not wired in.","status":"closed","priority":0,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-02-27T22:23:56Z","created_by":"Christopher Bartling","updated_at":"2026-02-27T22:32:37Z","closed_at":"2026-02-27T22:32:37Z"}
{"id":"otherworlds-rpg-brz","title":"Implement Session GET-by-ID query handler","description":"Shortcut crate requiring aggregate state enhancement. Add campaign_id/checkpoint_ids/branch_source fields to CampaignRun, rewrite apply() with match arms, upgrade reconstitute to proper deserialization, implement CampaignRunView + get_campaign_run_by_id, add GET /{run_id} API route with tests.","status":"closed","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-03-01T03:30:49Z","created_by":"Christopher Bartling","updated_at":"2026-03-01T04:06:56Z","closed_at":"2026-03-01T04:06:56Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-dzx","title":"Implement Character GET-by-ID query handler","description":"Shortcut crate requiring aggregate state enhancement. Add name/attributes/experience fields to Character aggregate, rewrite apply() with match arms, upgrade reconstitute to proper deserialization (return Result), implement CharacterView + get_character_by_id, add GET /{character_id} API route with tests.","status":"closed","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-03-01T03:30:46Z","created_by":"Christopher Bartling","updated_at":"2026-03-01T04:06:56Z","closed_at":"2026-03-01T04:06:56Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-f8u","title":"CRUD API endpoints","description":"Interactive plan mode session to start.","status":"open","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-03-01T15:44:29Z","created_by":"Christopher Bartling","updated_at":"2026-03-01T15:44:29Z"}
{"id":"otherworlds-rpg-kgd","title":"Implement Narrative GET-by-ID query handler","description":"Shortcut crate requiring aggregate state enhancement. Add current_beat_id/choice_ids fields to NarrativeSession, rewrite apply() with match arms, upgrade reconstitute to proper deserialization, implement NarrativeSessionView + get_session_by_id, add GET /{session_id} API route with tests.","status":"closed","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-03-01T03:30:48Z","created_by":"Christopher Bartling","updated_at":"2026-03-01T04:06:56Z","closed_at":"2026-03-01T04:06:56Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-kpv","title":"Implement Inventory GET-by-ID query handler (exemplar)","description":"Already-stateful aggregate. Change items to pub(crate), promote reconstitute to pub(crate), implement InventoryView + get_inventory_by_id in query_handlers.rs, add GET /{inventory_id} API route with tests.","status":"closed","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-03-01T03:30:39Z","created_by":"Christopher Bartling","updated_at":"2026-03-01T04:06:55Z","closed_at":"2026-03-01T04:06:55Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-lfe","title":"List API endpoints","description":"Interactive plan mode session to start.","status":"open","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-03-01T15:42:07Z","created_by":"Christopher Bartling","updated_at":"2026-03-01T15:42:07Z"}
{"id":"otherworlds-rpg-o9n","title":"Implement Rules GET-by-ID query handler","description":"Shortcut crate requiring aggregate state enhancement. Add intent_ids/check_ids fields to Resolution, rewrite apply() with match arms, upgrade reconstitute to proper deserialization, implement ResolutionView + get_resolution_by_id, add GET /{resolution_id} API route with tests.","status":"closed","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-03-01T03:30:52Z","created_by":"Christopher Bartling","updated_at":"2026-03-01T04:06:57Z","closed_at":"2026-03-01T04:06:57Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-t1a","title":"Add tracing instrumentation to narrative API handlers","description":"The narrative route handlers (advance_beat, present_choice) generate a correlation_id but never log it. The technical manifesto (section 11) requires every request to have a traceable correlation ID. Add #[tracing::instrument] or tracing::info! calls to emit correlation_id and session_id at the HTTP boundary. This is the exemplar for handler tracing — other context handlers will follow this pattern.","status":"closed","priority":0,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-02-28T00:00:00Z","created_by":"Christopher Bartling","updated_at":"2026-02-27T23:39:04Z","closed_at":"2026-02-27T23:39:04Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-t2b","title":"Implement Character domain crate","description":"Implement the Character bounded context end-to-end following the narrative exemplar pattern. Types already defined: CreateCharacter, ModifyAttribute, AwardExperience commands; CharacterCreated, AttributeModified, ExperienceGained events; Character aggregate skeleton. Implement: (1) aggregate domain methods that produce events, (2) command handlers with load-execute-persist flow, (3) API route handlers in otherworlds-api/src/routes/character.rs. Use TDD throughout.","status":"closed","priority":1,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-02-28T00:00:00Z","created_by":"Christopher Bartling","updated_at":"2026-02-28T00:01:48Z","closed_at":"2026-02-28T00:01:48Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-t3c","title":"Implement Rules and Resolution domain crate","description":"Implement the Rules and Resolution bounded context end-to-end following the narrative exemplar pattern. Types already defined: ResolveIntent, PerformCheck commands; IntentResolved, CheckPerformed, EffectsProduced events; Resolution aggregate skeleton. This is the core mechanical resolution context — skill checks, combat, deterministic outcomes. Must use DeterministicRng for all random outcomes. Implement: (1) aggregate domain methods, (2) command handlers, (3) API route handlers. Use TDD throughout.","status":"closed","priority":1,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-02-28T00:00:00Z","created_by":"Christopher Bartling","updated_at":"2026-02-28T08:23:30Z","closed_at":"2026-02-28T08:21:19Z"}
{"id":"otherworlds-rpg-t4d","title":"Implement World State domain crate","description":"Implement the World State bounded context end-to-end following the narrative exemplar pattern. Types already defined: ApplyEffect, SetFlag, UpdateDisposition commands; WorldFactChanged, FlagSet, DispositionUpdated events; WorldSnapshot aggregate skeleton. This context manages canonical world facts — flags, dispositions, locations, relationships. World state evolves only via explicit effects. Implement: (1) aggregate domain methods, (2) command handlers, (3) API route handlers. Use TDD throughout.","status":"closed","priority":1,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-02-28T00:00:00Z","created_by":"Christopher Bartling","updated_at":"2026-02-28T08:57:30Z","closed_at":"2026-02-28T08:57:30Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-t5e","title":"Implement Session and Progress domain crate","description":"Implement the Session and Progress bounded context end-to-end following the narrative exemplar pattern. Types already defined: StartCampaignRun, CreateCheckpoint, BranchTimeline commands; CampaignRunStarted, CheckpointCreated, TimelineBranched events; CampaignRun aggregate skeleton. This context manages campaign runs, save/load, checkpoints, replay, and branching timelines. Implement: (1) aggregate domain methods, (2) command handlers, (3) API route handlers. Use TDD throughout.","status":"closed","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-02-28T00:00:00Z","created_by":"Christopher Bartling","updated_at":"2026-02-28T15:57:26Z","closed_at":"2026-02-28T15:57:26Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-t6f","title":"Implement Inventory and Economy domain crate","description":"Implement the Inventory and Economy bounded context end-to-end following the narrative exemplar pattern. Types already defined: AddItem, RemoveItem, EquipItem commands; ItemAdded, ItemRemoved, ItemEquipped events; Inventory aggregate skeleton. Implement: (1) aggregate domain methods, (2) command handlers, (3) API route handlers. Use TDD throughout.","status":"closed","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-02-28T00:00:00Z","created_by":"Christopher Bartling","updated_at":"2026-02-28T16:31:44Z","closed_at":"2026-02-28T16:31:44Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-t7g","title":"Implement Content Authoring domain crate","description":"Implement the Content Authoring bounded context end-to-end following the narrative exemplar pattern. Types already defined: IngestCampaign, ValidateCampaign, CompileCampaign commands; CampaignIngested, CampaignValidated, CampaignCompiled events; Campaign aggregate skeleton. This context handles markdown-based campaign ingestion, validation, and compilation into runtime format. Implement: (1) aggregate domain methods, (2) command handlers, (3) API route handlers. Use TDD throughout.","status":"closed","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-02-28T00:00:00Z","created_by":"Christopher Bartling","updated_at":"2026-02-28T17:23:29Z","closed_at":"2026-02-28T17:23:29Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-t8h","title":"Extract shared test mock infrastructure","description":"MockEventRepository, FixedClock, and MockRng are duplicated across otherworlds-narrative command_handlers tests, otherworlds-api state tests, and otherworlds-api narrative route tests. As more domain crates get implemented, this duplication will grow. Extract shared test mocks into a reusable location — either a test_support module in otherworlds-core or a dedicated otherworlds-test-support crate. This prevents mock divergence when trait signatures change.","status":"closed","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-02-28T00:00:00Z","created_by":"Christopher Bartling","updated_at":"2026-03-01T03:02:39Z","closed_at":"2026-03-01T03:02:39Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-v7g","title":"Implement Content GET-by-ID query handler","description":"Already-stateful aggregate. Change ingested/validated/version_hash to pub(crate), promote reconstitute to pub(crate), implement CampaignView + get_campaign_by_id in query_handlers.rs, add GET /{campaign_id} API route with tests.","status":"closed","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-03-01T03:30:44Z","created_by":"Christopher Bartling","updated_at":"2026-03-01T04:06:56Z","closed_at":"2026-03-01T04:06:56Z","close_reason":"Closed"}
{"id":"otherworlds-rpg-w5f","title":"Implement World State GET-by-ID query handler","description":"Shortcut crate requiring aggregate state enhancement. Add facts/flags/disposition_entity_ids fields to WorldSnapshot, rewrite apply() with match arms, upgrade reconstitute to proper deserialization, implement WorldSnapshotView + get_world_snapshot_by_id, add GET /{world_id} API route with tests.","status":"closed","priority":2,"issue_type":"task","owner":"chris.bartling@gmail.com","created_at":"2026-03-01T03:30:51Z","created_by":"Christopher Bartling","updated_at":"2026-03-01T04:06:57Z","closed_at":"2026-03-01T04:06:57Z","close_reason":"Closed"}
